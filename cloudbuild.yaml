steps:
  - name: golang:1.13.4
    dir: 'clients/go/cmd/zbctl'
    timeout: 500s
    entrypoint: './build.sh'
  - name: maven:3.6.0-jdk-11-slim
    timeout: 500s
    entrypoint: mvn
    args:
      - 'package'
      - '-DfinalName=zeebe-distribution-cloud' # necessary to get a specific DISTBALL later on
      - '-P docker'
      - '-am' # also build dependents
      - '-DskipTests -Dcheckstyle.skip -Denforcer.skip -Dformatter.skip -Dlicense.skip' # skip checks
      - '-pl dist' # build only distribution package
  - name: gcr.io/cloud-builders/docker
    timeout: 500s
    args:
      - 'build'
      - '-t gcr.io/$PROJECT_ID/zeebe:$BRANCH_NAME'
      - '--build-arg=DISTBALL=dist/target/zeebe-distribution-cloud.tar.gz'
      - '.'
  - name: gcr.io/cloud-builders/docker
    timeout: 500s
    args:
      - 'push'
      - 'gcr.io/$PROJECT_ID/zeebe:$BRANCH_NAME'

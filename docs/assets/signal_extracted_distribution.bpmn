<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1etgo08" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.6.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.0.0">
  <bpmn:collaboration id="Collaboration_1ew5n04">
    <bpmn:participant id="Participant_0659yxt" name="Partition n" processRef="Process_04vv441" />
  </bpmn:collaboration>
  <bpmn:process id="Process_04vv441" isExecutable="true">
    <bpmn:laneSet id="LaneSet_1jdagzl">
      <bpmn:lane id="Lane_0amws1h">
        <bpmn:flowNodeRef>StartEvent_1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Event_0ra1das</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_06dq8ip</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_0fciosj</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_0binxxm</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_0iv4akl</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_0k31xjc</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:sequenceFlow id="Flow_0k25p19" sourceRef="Gateway_06dq8ip" targetRef="Gateway_0fciosj" />
    <bpmn:sequenceFlow id="Flow_08s07t3" sourceRef="Gateway_0fciosj" targetRef="Event_0ra1das" />
    <bpmn:startEvent id="StartEvent_1" name="Signal Broadcast">
      <bpmn:outgoing>Flow_1sk4fwq</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1ac272z" />
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_1sk4fwq" sourceRef="StartEvent_1" targetRef="Activity_0k31xjc" />
    <bpmn:sequenceFlow id="Flow_1443g1k" sourceRef="Activity_0k31xjc" targetRef="Activity_0binxxm" />
    <bpmn:sequenceFlow id="Flow_0x63gnk" name="Only when partition count &#62; 1 and command key encodes this partition id" sourceRef="Gateway_06dq8ip" targetRef="Activity_0iv4akl" />
    <bpmn:sequenceFlow id="Flow_04t4zxd" sourceRef="Activity_0iv4akl" targetRef="Gateway_0fciosj" />
    <bpmn:endEvent id="Event_0ra1das">
      <bpmn:incoming>Flow_08s07t3</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_06dq8ip" default="Flow_0k25p19">
      <bpmn:incoming>Flow_0pqc177</bpmn:incoming>
      <bpmn:outgoing>Flow_0x63gnk</bpmn:outgoing>
      <bpmn:outgoing>Flow_0k25p19</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_0fciosj">
      <bpmn:incoming>Flow_0k25p19</bpmn:incoming>
      <bpmn:incoming>Flow_04t4zxd</bpmn:incoming>
      <bpmn:outgoing>Flow_08s07t3</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:task id="Activity_0binxxm" name="Signal Broadcasted">
      <bpmn:incoming>Flow_1443g1k</bpmn:incoming>
      <bpmn:outgoing>Flow_0pqc177</bpmn:outgoing>
    </bpmn:task>
    <bpmn:sequenceFlow id="Flow_0pqc177" sourceRef="Activity_0binxxm" targetRef="Gateway_06dq8ip" />
    <bpmn:callActivity id="Activity_0iv4akl" name="Distribute Signal Broadcast">
      <bpmn:extensionElements>
        <zeebe:calledElement propagateAllChildVariables="false" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0x63gnk</bpmn:incoming>
      <bpmn:outgoing>Flow_04t4zxd</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:subProcess id="Activity_0k31xjc" name="For each matching signal subscription">
      <bpmn:incoming>Flow_1sk4fwq</bpmn:incoming>
      <bpmn:outgoing>Flow_1443g1k</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics />
      <bpmn:startEvent id="Event_0rfa2e5">
        <bpmn:outgoing>Flow_0m8s86r</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:callActivity id="Activity_0obm16h" name="Create Process Instance">
        <bpmn:extensionElements>
          <zeebe:calledElement propagateAllChildVariables="false" />
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_019n7f7</bpmn:incoming>
        <bpmn:outgoing>Flow_1qk3w8h</bpmn:outgoing>
      </bpmn:callActivity>
      <bpmn:endEvent id="Event_1s68uym" name="Instance created">
        <bpmn:incoming>Flow_1qk3w8h</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_1qk3w8h" sourceRef="Activity_0obm16h" targetRef="Event_1s68uym" />
      <bpmn:callActivity id="Activity_1epc6c8" name="Continue Process Instance">
        <bpmn:extensionElements>
          <zeebe:calledElement propagateAllChildVariables="false" />
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0gda7tf</bpmn:incoming>
        <bpmn:outgoing>Flow_0h2c6ka</bpmn:outgoing>
      </bpmn:callActivity>
      <bpmn:endEvent id="Event_00k50qv" name="Instance continued">
        <bpmn:incoming>Flow_0h2c6ka</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_0h2c6ka" sourceRef="Activity_1epc6c8" targetRef="Event_00k50qv" />
      <bpmn:exclusiveGateway id="Gateway_01d601i" name="Is subscription for top-level start event?">
        <bpmn:incoming>Flow_0m8s86r</bpmn:incoming>
        <bpmn:outgoing>Flow_1gvq3ut</bpmn:outgoing>
        <bpmn:outgoing>Flow_0gda7tf</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_0m8s86r" sourceRef="Event_0rfa2e5" targetRef="Gateway_01d601i" />
      <bpmn:exclusiveGateway id="Gateway_1xjprg3" name="Does signal key encode this partition id?">
        <bpmn:incoming>Flow_1gvq3ut</bpmn:incoming>
        <bpmn:outgoing>Flow_019n7f7</bpmn:outgoing>
        <bpmn:outgoing>Flow_1cirsqd</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_1gvq3ut" name="Yes" sourceRef="Gateway_01d601i" targetRef="Gateway_1xjprg3" />
      <bpmn:sequenceFlow id="Flow_0gda7tf" name="No" sourceRef="Gateway_01d601i" targetRef="Activity_1epc6c8" />
      <bpmn:sequenceFlow id="Flow_019n7f7" name="Yes" sourceRef="Gateway_1xjprg3" targetRef="Activity_0obm16h" />
      <bpmn:endEvent id="Event_11vului" name="Instance will be created on other partition">
        <bpmn:incoming>Flow_1cirsqd</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_1cirsqd" name="No" sourceRef="Gateway_1xjprg3" targetRef="Event_11vului" />
      <bpmn:textAnnotation id="TextAnnotation_0ckplgf">
        <bpmn:text>Sometimes the specific logic needs to be aware of whether the command was distributed or not</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:association id="Association_0elpspj" sourceRef="Gateway_1xjprg3" targetRef="TextAnnotation_0ckplgf" />
    </bpmn:subProcess>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1ew5n04">
      <bpmndi:BPMNShape id="Participant_0659yxt_di" bpmnElement="Participant_0659yxt" isHorizontal="true">
        <dc:Bounds x="140" y="77" width="1420" height="533" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0amws1h_di" bpmnElement="Lane_0amws1h" isHorizontal="true">
        <dc:Bounds x="170" y="77" width="1390" height="533" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0xqu31u_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="232" y="429" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="216" y="403" width="84" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ra1das_di" bpmnElement="Event_0ra1das">
        <dc:Bounds x="1502" y="429" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_00xwb47_di" bpmnElement="Gateway_06dq8ip" isMarkerVisible="true">
        <dc:Bounds x="1085" y="422" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_14bkv1w_di" bpmnElement="Gateway_0fciosj" isMarkerVisible="true">
        <dc:Bounds x="1395" y="422" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0binxxm_di" bpmnElement="Activity_0binxxm">
        <dc:Bounds x="940" y="407" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_01i6z1n_di" bpmnElement="Activity_0iv4akl">
        <dc:Bounds x="1240" y="510" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0z01f1n_di" bpmnElement="Activity_0k31xjc" isExpanded="true">
        <dc:Bounds x="320" y="120" width="590" height="430" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0ckplgf_di" bpmnElement="TextAnnotation_0ckplgf">
        <dc:Bounds x="340" y="460" width="190" height="50" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0yy7jqh_di" bpmnElement="Activity_0obm16h">
        <dc:Bounds x="650" y="287" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1s68uym_di" bpmnElement="Event_1s68uym">
        <dc:Bounds x="802" y="309" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="779" y="352" width="82" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1np7gue_di" bpmnElement="Activity_1epc6c8">
        <dc:Bounds x="650" y="160" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_00k50qv_di" bpmnElement="Event_00k50qv">
        <dc:Bounds x="802" y="182" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="796" y="225" width="48" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0rfa2e5_di" bpmnElement="Event_0rfa2e5">
        <dc:Bounds x="352.3333333333333" y="251" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_01d601i_di" bpmnElement="Gateway_01d601i" isMarkerVisible="true">
        <dc:Bounds x="445" y="244" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="504.5" y="249" width="87" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_11vului_di" bpmnElement="Event_11vului">
        <dc:Bounds x="802" y="412" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="780" y="455" width="81" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1xjprg3_di" bpmnElement="Gateway_1xjprg3" isMarkerVisible="true">
        <dc:Bounds x="555" y="405" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="541" y="465" width="78" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0elpspj_di" bpmnElement="Association_0elpspj">
        <di:waypoint x="560" y="435" />
        <di:waypoint x="453" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_019n7f7_di" bpmnElement="Flow_019n7f7">
        <di:waypoint x="580" y="405" />
        <di:waypoint x="580" y="330" />
        <di:waypoint x="650" y="330" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="560" y="358" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1qk3w8h_di" bpmnElement="Flow_1qk3w8h">
        <di:waypoint x="750" y="327" />
        <di:waypoint x="802" y="327" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0gda7tf_di" bpmnElement="Flow_0gda7tf">
        <di:waypoint x="470" y="244" />
        <di:waypoint x="470" y="190" />
        <di:waypoint x="650" y="190" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="478" y="214" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0h2c6ka_di" bpmnElement="Flow_0h2c6ka">
        <di:waypoint x="750" y="200" />
        <di:waypoint x="802" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0m8s86r_di" bpmnElement="Flow_0m8s86r">
        <di:waypoint x="388" y="269" />
        <di:waypoint x="445" y="269" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gvq3ut_di" bpmnElement="Flow_1gvq3ut">
        <di:waypoint x="470" y="294" />
        <di:waypoint x="470" y="430" />
        <di:waypoint x="555" y="430" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="476" y="411" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1cirsqd_di" bpmnElement="Flow_1cirsqd">
        <di:waypoint x="605" y="430" />
        <di:waypoint x="802" y="430" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="696" y="412" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0k25p19_di" bpmnElement="Flow_0k25p19">
        <di:waypoint x="1135" y="447" />
        <di:waypoint x="1395" y="447" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08s07t3_di" bpmnElement="Flow_08s07t3">
        <di:waypoint x="1445" y="447" />
        <di:waypoint x="1502" y="447" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0x63gnk_di" bpmnElement="Flow_0x63gnk">
        <di:waypoint x="1110" y="472" />
        <di:waypoint x="1110" y="550" />
        <di:waypoint x="1240" y="550" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1115" y="477" width="82" height="66" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1sk4fwq_di" bpmnElement="Flow_1sk4fwq">
        <di:waypoint x="268" y="447" />
        <di:waypoint x="320" y="447" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1443g1k_di" bpmnElement="Flow_1443g1k">
        <di:waypoint x="910" y="447" />
        <di:waypoint x="940" y="447" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_04t4zxd_di" bpmnElement="Flow_04t4zxd">
        <di:waypoint x="1340" y="550" />
        <di:waypoint x="1420" y="550" />
        <di:waypoint x="1420" y="472" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0pqc177_di" bpmnElement="Flow_0pqc177">
        <di:waypoint x="1040" y="447" />
        <di:waypoint x="1085" y="447" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>

name: Login to Harbor Registry
description: |
  Local action to simplify login to the Harbor registry
inputs:
  secrets:
    description: JSON wrapped secrets for easier secret passing
    required: true
  env:
    description: Environment prefix, e.g. "dev." or "stage."
    required: false
    default: ''
runs:
  using: composite
  steps:
  - name: Import secrets
    id: secrets
    uses: hashicorp/vault-action@cb841f2c86fb6d07cff94fda240828c1abc5ba43
    with:
      url: ${{ fromJSON(inputs.secrets).VAULT_ADDR }}
      method: approle
      roleId: ${{ fromJSON(inputs.secrets).VAULT_ROLE_ID }}
      secretId: ${{ fromJSON(inputs.secrets).VAULT_SECRET_ID }}
      secrets: |
        secret/data/products/optimize/ci/optimize NEXUS_USERNAME;
        secret/data/products/optimize/ci/optimize NEXUS_PASSWORD;
  - name: Login to Harbor docker registery
    uses: docker/login-action@343f7c4344506bcbf9b4de18042ae17996df046d # v3
    with:
      registry: ${{ inputs.env }}registry.camunda.cloud
      username: ${{ steps.secrets.outputs.NEXUS_USERNAME }}
      password: ${{ steps.secrets.outputs.NEXUS_PASSWORD }}

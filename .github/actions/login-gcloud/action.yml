name: Login to Google Cloud
description: |
  Local action to simplify login to Google Cloud
inputs:
  secrets:
    description: JSON wrapped secrets for easier secret passing
    required: true
  project_id:
    description: Google Cloud project ID
    required: false
    default: ci-30-162810
runs:
  using: composite
  steps:
    - name: Import secrets
      id: secrets
      uses: hashicorp/vault-action@6853090cd99ab382c4830a1ae8966b5a906315b6
      with:
        url: ${{ fromJSON(inputs.secrets).VAULT_ADDR }}
        method: approle
        roleId: ${{ fromJSON(inputs.secrets).VAULT_ROLE_ID }}
        secretId: ${{ fromJSON(inputs.secrets).VAULT_SECRET_ID }}
        secrets: |
          secret/data/products/optimize/ci/camunda-optimize CI_SERVICE_ACCOUNT | GCP_CREDENTIALS;
    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@67e9c72af6e0492df856527b474995862b7b6591 # v2
      with:
        credentials_json: ${{ steps.secrets.outputs.GCP_CREDENTIALS }}

    - name: Configure Google SDK
      uses: google-github-actions/setup-gcloud@825196879a077b7efa50db2e88409f44de4635c2 # v2.0.0
      with:
        project_id: ${{ inputs.project_id }}
        install_components: gke-gcloud-auth-plugin, kubectl

name: Login to Google Cloud
description: |
  Local action to simplify login to Google Cloud
inputs:
  secrets:
    description: JSON wrapped secrets for easier secret passing
    required: true
  project_id:
    description: Google Cloud project ID
    required: false
    default: ci-30-162810
runs:
  using: composite
  steps:
    - name: Import secrets
      id: secrets
      uses: hashicorp/vault-action@2d9c2b9f1b63f4f28f8c33dab5ab969962f1beeb
      with:
        url: ${{ fromJSON(inputs.secrets).VAULT_ADDR }}
        method: approle
        roleId: ${{ fromJSON(inputs.secrets).VAULT_ROLE_ID }}
        secretId: ${{ fromJSON(inputs.secrets).VAULT_SECRET_ID }}
        secrets: |
          secret/data/products/optimize/ci/camunda-optimize CI_SERVICE_ACCOUNT | GCP_CREDENTIALS;
    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v1
      with:
        credentials_json: ${{ steps.secrets.outputs.GCP_CREDENTIALS }}

    - name: Configure Google SDK
      uses: google-github-actions/setup-gcloud@v1.1.1
      with:
        project_id: ${{ inputs.project_id }}
        install_components: gke-gcloud-auth-plugin, kubectl

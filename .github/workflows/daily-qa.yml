# This workflow runs our daily scheduled acceptance tests. It runs each test suite against the
# development head (e.g. main) and all officially supported branches.
#
# As this is meant to be run via scheduling, the workflow itself only runs on the default branch
# (e.g. main), so any changes you make will affect any other branches we test via this workflow.
name: Daily tests

on:
  workflow_dispatch: { }
  schedule:
    # Runs at 01:00 every day; see this link for more: https://crontab.guru/#0_1_*_*_*
    - cron: '0 1 * * *'

env:
  # This URL is used as the business key for the various QA workflows
  BUILD_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
  LATEST_STABLE_VERSION: 8.1.3
  PREVIOUS_LATEST_VERSION: 8.0.8

jobs:
  # Runs the qa-testbench workflow against the stable branches. It assumes that branches follow the
  # pattern of `stable/VERSION`, and generations of `Zeebe VERSION`.
  qa:
    needs:
      - get-versions
    strategy:
      matrix:
        include:
          - branch: 'main'
            generation: 'Zeebe SNAPSHOT'
          - branch: 'stable/8.0'
            generation: 'Zeebe 8.0.8'
          - branch: 'stable/8.1'
            generation: 'Zeebe 8.1.3'
    name: Daily QA
    uses: ./.github/workflows/qa-testbench.yaml
    with:
      branch: ${{ matrix.branch }}
      generation: ${{ matrix.generation }}
    secrets: inherit

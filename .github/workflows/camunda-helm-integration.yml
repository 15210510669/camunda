name: Camunda Helm Chart Integration Test

on:
  schedule:
    - cron: '0 5 * * *'
  workflow_dispatch:
  pull_request:

jobs:
  helm-deploy:
    name: Helm chart Integration Tests
    uses: camunda/camunda-platform-helm/.github/workflows/test-integration-template.yaml@main
    secrets: inherit
    with:
      identifier: camunda-helm-int
      camunda-helm-dir: camunda-platform-alpha
      test-enabled: true
      caller-git-ref: main
      extra-values: |
        zeebe:
          image:
            repository: camunda/camunda
            tag: SNAPSHOT
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: broker
        operate:
          image:
            repository: camunda/camunda
            tag: SNAPSHOT
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: operate
        tasklist:
          image:
            repository: camunda/camunda
            tag: SNAPSHOT
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: tasklist
      vault-secret-mapping: |
        secret/data/products/zeebe/ci/zeebe REGISTRY_HUB_DOCKER_COM_USR | TEST_DOCKER_USERNAME;
        secret/data/products/zeebe/ci/zeebe REGISTRY_HUB_DOCKER_COM_PSW | TEST_DOCKER_PASSWORD;
        secret/data/github.com/organizations/camunda NEXUS_USR | TEST_DOCKER_USERNAME_CAMUNDA_CLOUD;
        secret/data/github.com/organizations/camunda NEXUS_PSW | TEST_DOCKER_PASSWORD_CAMUNDA_CLOUD;

# This GitHub Actions workflow that is triggered on push to `master` and `stable/**` branch or on any pull request creation
# and invokes `ci-reusable` workflow.

name: CI
on:
  workflow_dispatch:
  push:
    branches:
      - 'master'
      - 'stable/**'
  pull_request:

jobs:
  run-build-es:
    name: run-es
    uses: ./.github/workflows/ci-reusable.yml
    secrets: inherit
    with:
      branch: ${{ github.head_ref || github.ref_name }} # head_ref = branch name on PR, ref_name = `master` or `stable/**`
      testProfile: docker-es
      database: elasticsearch
    concurrency:
      group: ci-es-${{ github.head_ref || github.ref_name }}
      cancel-in-progress: true
  run-build-os:
    name: run-os
    uses: ./.github/workflows/ci-reusable.yml
    secrets: inherit
    with:
      branch: ${{ github.head_ref || github.ref_name }} # head_ref = branch name on PR, ref_name = `master` or `stable/**`
      testProfile: docker-os
      database: opensearch
    concurrency:
      group: ci-os-${{ github.head_ref || github.ref_name }}
      cancel-in-progress: true
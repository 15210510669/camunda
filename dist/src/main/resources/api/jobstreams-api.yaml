openapi: "3.0.2"
info:
  title: Job Streams Management API
  version: "1.0"
  description: Management endpoint to query job streams in Zeebe
servers:
  - url: "{schema}://{host}:{port}/actuator/jobstreams"
    variables:
      host:
        default: localhost
        description: Management server hostname
      port:
        default: "9600"
        description: Management server port
      schema:
        default: http
        description: Management server schema
paths:
  /:
    get:
      summary: Lists all registered job streams
      description: |
        Lists all registered job streams, whether client (gateway) or remote (broker). On a gateway,
        the remote list is always empty. On a broker, the client list is only filled if there is an
        embedded gateway running.
      responses:
        '200':
          description: A backup has been successfully scheduled
          $ref: '#/components/responses/JobStreams'
  /client:
    get:
      summary: Lists only client (gateway) job streams
      description: |
        Returns a list of all known client job streams registered for this gateway. If the node is
        instead a broker, an empty list is returned.
      responses:
        '200':
          description: OK
          $ref: '#/components/responses/ClientJobStreamList'
  /remote:
    get:
      summary: Lists only remote (broker) job streams
      description: |
        Returns a list of all known remote job streams registered for this broker. If the node is
        instead a gateway, an empty list is returned.
      responses:
        '200':
          description: OK
          $ref: '#/components/responses/RemoteJobStreamList'

components:
  responses:
    Error:
      description: Generic error response
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/Error"
    JobStreams:
      description: |
        The combined client and remote job streams.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JobStreams'
    ClientJobStreamList:
      description: |
        The list of registered client job streams.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ClientJobStreamList'
    RemoteJobStreamList:
      description: |
        The list of registered remote job streams.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RemoteJobStreamList'

  schemas:
    Error:
      title: Error response
      description: Generic response for all errors
      type: object
      properties:
        message:
          description: Error message
          type: string
          example: something failed
    ClientStreamId:
      title: Client Stream ID
      description: |
        The unique ID of the job stream on the client/gateway side.
      type: object
    RemoteStreamId:
      title: Remote Stream ID
      description: |
        The globally unique remote stream ID used to register aggregated streams on brokers.
      type: object
      properties:
        id:
          type: string
          format: uuid
        receiver:
          type: string
    Metadata:
      title: Job Activation Properties
      description: |
        The job activation properties for this job stream.
      type: object
      properties:
        worker:
          description: Human readable worker name
          type: string
        timeout:
          description: Job activation timeout in milliseconds
          type: integer
          format: int64
        fetchVariables:
          type: array
          items:
            type: string
    RemoteJobStream:
      title: Remote Job Stream
      description: |
        A remote job stream, as registered on a broker.
      type: object
      properties:
        jobType:
          type: string
        metadata:
          $ref: '#/components/schemas/Metadata'
        consumers:
          type: array
          items:
            $ref: '#/components/schemas/RemoteStreamId'
    ClientJobStream:
      title: Client Job Stream
      description: |
        A client job stream, as registered on a gateway.
      type: object
      properties:
        jobType:
          type: string
        metadata:
          $ref: '#/components/schemas/Metadata'
        id:
          $ref: '#/components/schemas/ClientStreamId'
        connectedTo:
          type: array
          items:
            type: integer
            format: int32
    ClientJobStreamList:
      title: Client Job Stream List
      description: |
        A list of client job streams.
      type: array
      items:
        $ref: '#/components/schemas/ClientJobStream'
    RemoteJobStreamList:
      title: Remote Job Stream List
      description: |
        A list of remote job streams.
      type: array
      items:
        $ref: '#/components/schemas/RemoteJobStream'
    JobStreams:
      title: Job Streams
      description: A map of all known job streams.
      type: object
      properties:
        client:
          $ref: '#/components/schemas/ClientJobStreamList'
        remote:
          $ref: '#/components/schemas/RemoteJobStreamList'

---
# Default values for Operate Preview Environments

# The values file follows helm best practices https://helm.sh/docs/chart_best_practices/values/
# This means:
#   * Variable names should begin with a lowercase letter, and words should be separated with camelcase.
#   * Every defined property in values.yaml should be documented. The documentation string should begin with the name of the property that it describes, and then give at least a one-sentence description


ingress:
  # Defines the domain under which to expose the ingress
  domain: operate.camunda.cloud


git:
  # Defines the branch name to use for annotating resources
  branch: master
  # Defines the repository URL to use for annotating resources
  repoUrl: https://github.com/camunda/operate


# Configuration of the camunda-platform chart, in particular we disable some features that
# we don't want to deploy. We also change the `fullNameOverride` and `zeebeClusterName`
# to simpler values, so we don't duplicate
# the ReleaseName everwhere (as that's already reflected in the Namespace).
camunda-platform:
  operate:
    fullnameOverride: operate
    # Defines the image repo and tag to be deployed. Tag is usually overridden to a specific tag produced by CI.
    image:
      repository: registry.camunda.cloud/team-operate/camunda-operate
      tag: latest
    env:
    - name: JAVA_OPTS
      value: "-XX:MaxRAMFraction=1"
    - name: SPRING_PROFILES_ACTIVE
      value: dev-data
    - name: CAMUNDA_OPERATE_TASKLIST_URL
      value: https://stage.zeebe-tasklist.camunda.cloud/
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 0.5
        memory: 512Mi
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  optimize:
    enabled: false

  tasklist:
    enabled: false

  # identity needs to be disabled explicitly
  identity:
    enabled: false

  zeebe:
    # Defines the size of the zeebe cluster.
    clusterSize: 1
    fullnameOverride: zeebe
    # Defines the version of Zeebe to use
    image:
      tag: 8.2.0-rc1
    partitionCount: 1
    # Enable the creation of persistent volumes.
    persistenceType: disk
    # Defines a reasonable default for the `zeebe` StatefulSet, for when persistence is enabled.
    pvcSize: 1Gi
    replicationFactor: 1
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 500m
        memory: 512Mi
  zeebe-gateway:
    # Defines the version of Zeebe to use
    image:
      tag: 8.2.0-rc1
    fullnameOverride: zeebe-gateway
    replicas: 1
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  # Configuration for ElasticSearch. Persistence is disabled by default,
  # and we're setting some reasonable defaults for the `PersistentVolumeClaim` size
  # in order to avoid being too wasteful.
  # Feel free to enable persistence and adjust storage on a per-branch level whenever needed.
  elasticsearch:
    # Defines the version of ElasticSearch to use
    imageTag: 7.16.2
    replicas: 1
    # This is needed to disable the creation of poddisruptionbudget resource coming from ES chart (supported in k8s 1.21)
    maxUnavailable: ""
    minimumMasterNodes: 1
    extraEnvs:
    - name: xpack.security.enabled
      value: "false"
    - name: processors
      value: "1"
    clusterHealthCheckParams: wait_for_status=yellow&timeout=1s
    esJavaOpts: "-Xms512m -Xmx512m"
    persistence:
      enabled: true
    securityContext:
      capabilities:
        add:
          - IPC_LOCK
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 0.5
        memory: 512Mi
    initResources:
     limits:
       cpu: "25m"
       memory: "128Mi"
     requests:
       cpu: "25m"
       memory: "128Mi"
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"
    volumeClaimTemplate:
      resources:
        requests:
          storage: 1Gi

# Configuration of global values as required by the camunda-platform chart and to comply
# with Infra best practices.
global:
  image:
    pullSecrets:
      - name: registry-camunda-cloud
  zeebeClusterName: zeebe
  # identity should be explicitly disabled in global as well
  identity:
    # Identity.auth configuration, to configure Identity authentication setup
    auth:
      # Identity.auth.enabled if true, enables the Identity authentication otherwise basic-auth will be used on all services.
      enabled: false
  labels:
    camunda.cloud/source: argocd
    camunda.cloud/managed-by: Helm
    app: preview-operate-camunda-cloud # Should be overridden by Argo app
